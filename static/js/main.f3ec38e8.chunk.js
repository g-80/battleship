(this.webpackJsonpbattleship=this.webpackJsonpbattleship||[]).push([[0],{16:function(t,e,a){},18:function(t,e,a){"use strict";a.r(e);var n=a(1),i=a.n(n),o=a(11),r=a.n(o),s=(a(16),a(4)),c=a(3),u=function(){for(var t=[],e=0;e<100;e++)t.push({hasShip:!1,isShot:!1});return{board:t,createLocationArray:function(t,e,a){for(var n=[],i=0;i<e;i++)"x"===a?n.push(t+i):n.push(t+10*i);return n},updateCellsHaveShip:function(t){var e=this;t.forEach((function(t){e.board[t].hasShip=!0}))},checkCollisions:function(t){var e=this;return!t.some((function(t){return!e.board[t]}))&&(!t.some((function(t){return e.board[t].hasShip}))&&![9,19,29,39,49,59,69,79,89,99].some((function(e){return[e,e+1].every((function(e){return t.includes(e)}))})))},receiveAttack:function(t){this.board[t].isShot=!0},isShipHit:function(t){return this.board[t].hasShip},areAllShipsSunk:function(){return this.board.filter((function(t){return t.hasShip})).every((function(t){return t.isShot}))},opponentBoard:function(){return this.board.map((function(t){return t.isShot&&t.hasShip?"hit":t.isShot?"miss":"empty"}))}}},l=function(t){return{type:t,ships:[],gameboard:u(),attack:function(t,e){"empty"===e.opponentBoard()[t]&&e.receiveAttack(t)}}},h=function(){var t={availableShots:[],shotsHit:[],sunkShipsCells:[],getRandomItemFromArray:function(t){return t[Math.floor(Math.random()*t.length)]},updateAvailableShots:function(t){var e=this,a=t.opponentBoard(),n=[],i=[];a.forEach((function(t,a){if("empty"===t)n.push(a);else if("hit"===t){if(e.sunkShipsCells.includes(a))return;i.push(a)}e.availableShots=n,e.shotsHit=i}))},filterShotsHit:function(t){var e=this;this.shotsHit=this.shotsHit.filter((function(a){if(!t.find((function(t){return t.position.includes(a)})).isSunk())return!0;e.sunkShipsCells.push(a)}))},detectShips:function(){var t=this,e=this.shotsHit.filter((function(t,e,a){return a.includes(t+1)&&(t+1)%10!==0||a.includes(t-1)&&t%10!==0||a.includes(t+10)||a.includes(t-10)}));if((e=e.filter((function(t,e,a){return a.lastIndexOf(t)===e}))).length){var a=e[0],n=[];if("x"===(e[1]-a===1?"x":"y")){a%10!==0&&n.push(a-1);var i=e.find((function(t,e,a){return!a.includes(t+1)}));(i+1)%10!==0&&n.push(i+1)}else{a-10>=0&&n.push(a-10);var o=e.find((function(t,e,a){return!a.includes(t+10)}));o+10<=100&&n.push(o+10)}return n.filter((function(e){return t.availableShots.includes(e)}))}},followUpSingleHits:function(){var t=this,e=this.shotsHit[0];return[e+1,e-1,e+10,e-10].filter((function(a){if(t.availableShots.includes(a))return e%10===0?(a+1)%10!==0:(e+1)%10!==0||a%10!==0}))},getRandomLocation:function(){return this.getRandomItemFromArray(this.availableShots)},getAttackLocation:function(){}};return Object.assign({},l("ai"),t)};var p=function(t,e){var a=e.type,n=e.payload;switch(a){case"CREATE_PLAYERS":return Object(c.a)(Object(c.a)({},t),{},{players:{human:l("human"),ai:h()}});case"SET_STAGE":return Object(c.a)(Object(c.a)({},t),{},{stage:n});case"SET_MESSAGE":return Object(c.a)(Object(c.a)({},t),{},{message:n});case"SET_PLAYER_SHIPS":var i=n.player,o=n.ships,r=Object(c.a)({},t);return r.players[i].ships=o,Object(c.a)({},r);case"SET_TURN":return Object(c.a)(Object(c.a)({},t),{},{turn:n});case"SET_WINNER":return Object(c.a)(Object(c.a)({},t),{},{winner:n});case"RESTART_GAME":return m;default:return t}},d=a(0),f=Object(n.createContext)(),m={players:{},turn:"",stage:"init",message:"",winner:""};var b=function(t){var e=Object(n.useReducer)(p,m),a=Object(s.a)(e,2),i=a[0],o=a[1];return Object(d.jsx)(f.Provider,{value:{state:i,dispatch:o},children:t.children})},S=a(9),j=a.n(S);var v=function(){var t=Object(n.useContext)(f).dispatch;return Object(d.jsxs)("div",{className:j.a.flexContainer,children:[Object(d.jsx)("h1",{className:j.a.gameTitle,children:"Battleship"}),Object(d.jsx)("button",{onClick:function(){t({type:"CREATE_PLAYERS"}),t({type:"SET_STAGE",payload:"ships_placement"})},className:"btn-main",children:"Start"})]})},y=a(10),E=function(t,e){return{name:t,length:e.length,position:e,hits:[],hit:function(t){this.hits.push(t)},isSunk:function(){var t=this;return this.position.every((function(e){return t.hits.includes(e)}))}}},_=[{name:"Carrier",length:5},{name:"Battleship",length:4},{name:"Destroyer",length:3},{name:"Submarine",length:3},{name:"Patrol boat",length:2}],g=function(t){var e=[];return _.forEach((function(a,n){var i=t[n],o=E(a.name,i);e.push(o)})),e},O=function(t,e,a){a({type:"SET_PLAYER_SHIPS",payload:{player:t,ships:e}})},x=function(t,e){var a=[];_.forEach((function(e){var n=function(t,e){var a=["x","y"],n=a[Math.floor(Math.random()*a.length)],i=[];t.board.forEach((function(a,o){var r=t.createLocationArray(o,e,n);t.checkCollisions(r)&&i.push(o)}));var o=i[Math.floor(Math.random()*i.length)];return t.createLocationArray(o,e,n)}(t,e.length);t.updateCellsHaveShip(n),a.push(n)}));var n=g(a);O("ai",n,e)},A=a(2),T=a.n(A);var k=function(t){var e=t.owner,a=t.stage,n=t.board,i=t.allowed,o=t.onClickHandler,r=t.mouseEnterHandler,s=t.mouseLeaveHandler,c=function(t,n,o){return"ships_placement"===a?"main"===o?t.hasShip?T.a.hasShip:T.a.cell:i.includes(n)?T.a.allowed:T.a.notAllowed:"main"===o?t.isShot&&t.hasShip?T.a.attackHit:t.isShot?T.a.attackMiss:t.hasShip&&"human"===e?T.a.hasShip:T.a.cell:"ai"===e?i.includes(n)?T.a.attackAllowed:T.a.notAllowed:void 0};return Object(d.jsx)(d.Fragment,{children:Object(d.jsx)("div",{className:"".concat(T.a.gameboard," ").concat("ships_placement"===a?T.a.wml:""),children:n.map((function(t,n){return"ai"===e||"ships_placement"===a?Object(d.jsx)("div",{className:"".concat(c(t,n,"main")," ").concat(c(t,n,"hover")),onClick:o,onMouseEnter:function(){r(n)},onMouseLeave:s},"cell-".concat(n)):Object(d.jsx)("div",{className:"".concat(c(t,n,"main")," ").concat(c(t,n,"hover")),style:{cursor:"default"}},"cell-".concat(n))}))})})},C=a(7),w=a.n(C);var H=function(){var t=Object(n.useState)(0),e=Object(s.a)(t,2),a=e[0],i=e[1],o=Object(n.useState)("x"),r=Object(s.a)(o,2),c=r[0],u=r[1],l=Object(n.useState)([]),h=Object(s.a)(l,2),p=h[0],m=h[1],b=Object(n.useState)([]),S=Object(s.a)(b,2),j=S[0],v=S[1],E=Object(n.useState)(_),A=Object(s.a)(E,2),T=A[0],C=A[1],H=Object(n.useContext)(f),M=H.state,N=H.dispatch,R=M.players,G=R.human.gameboard;return Object(n.useEffect)((function(){x(R.ai.gameboard,N),N({type:"SET_MESSAGE",payload:"Place your ships on the gameboard"})}),[]),Object(d.jsxs)("div",{children:[Object(d.jsxs)("div",{className:w.a.axisContainer,children:[Object(d.jsx)("span",{children:"Axis"}),Object(d.jsx)("button",{onClick:function(){u("x"===c?"y":"x")},className:w.a.axisBtn,children:c})]}),Object(d.jsxs)("div",{className:"board-container",style:{marginTop:"1%"},children:[Object(d.jsx)(k,{stage:M.stage,owner:"human",board:G.board,allowed:p,onClickHandler:function(){if(p.length)if(G.updateCellsHaveShip(p),a<4&&v([].concat(Object(y.a)(j),[p])),a>=4){m([]);var t=g(j);O("human",t,N),N({type:"SET_STAGE",payload:"battle"})}else C((function(t){return t.filter((function(t){return!(t.name===_[a].name)}))})),i(a+1),m([])},mouseEnterHandler:function(t){var e=_[a].length,n=G.createLocationArray(t,e,c);G.checkCollisions(n)?(m(n),4===a&&v([].concat(Object(y.a)(j),[n]))):m([])},mouseLeaveHandler:function(){if(4===a){var t=j.filter((function(t){return t.length>2}));v(t)}m([])}}),Object(d.jsx)("ul",{className:w.a.list,children:T.map((function(t,e){return Object(d.jsx)("li",{children:t.name},"toPlace".concat(e))}))})]})]})},M=function(t,e,a){var n=e.ships.find((function(e){return e.position.includes(t)}));n.hit(t),"human"===e.type?a({type:"SET_MESSAGE",payload:"Your opponent hit your ".concat(n.name)}):a({type:"SET_MESSAGE",payload:"You hit an opponent's ship"}),n.isSunk()&&("human"===e.type?a({type:"SET_MESSAGE",payload:"Your ".concat(n.name," has sunk")}):a({type:"SET_MESSAGE",payload:"You have sunked your opponents's ".concat(n.name)}))},N=function(t,e,a){e.areAllShipsSunk()&&(a({type:"SET_WINNER",payload:t}),a({type:"SET_TURN",payload:""}),a({type:"SET_STAGE",payload:"game_over"}))};var R=function(){var t=Object(n.useState)([]),e=Object(s.a)(t,2),a=e[0],i=e[1],o=Object(n.useState)(),r=Object(s.a)(o,2),c=r[0],u=r[1],l=Object(n.useContext)(f),h=l.state,p=l.dispatch,m=h.players,b=m.human,S=m.ai,j=function(){i((function(){return S.gameboard.opponentBoard().map((function(t,e){if("empty"===t)return e}))}))};return Object(n.useEffect)((function(){j(),p({type:"SET_TURN",payload:"human"}),p({type:"SET_MESSAGE",payload:"It's your turn. Attack your opponent's ships"})}),[]),Object(n.useEffect)((function(){console.log(S.ships),"ai"===h.turn&&setTimeout((function(){return function(t,e,a){var n;if(t.updateAvailableShots(e.gameboard),t.filterShotsHit(e.ships),0===t.shotsHit.length)n=t.getRandomLocation();else if(1===t.shotsHit.length){var i=t.followUpSingleHits();n=t.getRandomItemFromArray(i)}else{var o=t.detectShips();n=t.getRandomItemFromArray(o)}t.attack(n,e.gameboard),e.gameboard.isShipHit(n)?(M(n,e,a),N("ai",e.gameboard,a)):a({type:"SET_MESSAGE",payload:"The opponent's shot misses"}),setTimeout((function(){a({type:"SET_TURN",payload:"human"}),a({type:"SET_MESSAGE",payload:"It's your turn. Attack your opponent's ships"})}),1200)}(S,b,p)}),750)}),[h.turn]),Object(d.jsxs)("div",{className:"board-container",style:{justifyContent:"space-evenly"},children:[Object(d.jsx)(k,{owner:"human",board:b.gameboard.board}),Object(d.jsx)(k,{owner:"ai",board:S.gameboard.board,allowed:a,onClickHandler:function(){var t=c;a.includes(t)&&"human"===h.turn&&(b.attack(t,S.gameboard),S.gameboard.isShipHit(t)?(M(t,S,p),N("human",S.gameboard,p)):p({type:"SET_MESSAGE",payload:"Your shot misses"}),j(),setTimeout((function(){p({type:"SET_TURN",payload:"ai"}),p({type:"SET_MESSAGE",payload:"It's your opponents turn"})}),1200))},mouseEnterHandler:function(t){u(t)},mouseLeaveHandler:function(){u()}})]})};var G=function(){var t=Object(n.useContext)(f),e=t.state,a=t.dispatch;return Object(n.useEffect)((function(){"human"===e.winner?a({type:"SET_MESSAGE",payload:"You win"}):a({type:"SET_MESSAGE",payload:"Computer AI wins"})}),[]),Object(d.jsx)("div",{className:"board-container",children:Object(d.jsx)("button",{onClick:function(){a({type:"RESTART_GAME"})},className:"btn-main",children:"Play again"})})};var L=function(){var t,e=Object(n.useContext)(f).state;switch(e.stage){case"init":t=Object(d.jsx)(v,{});break;case"ships_placement":t=Object(d.jsx)(H,{});break;case"battle":t=Object(d.jsx)(R,{});break;case"game_over":t=Object(d.jsx)(G,{})}return Object(d.jsxs)(d.Fragment,{children:["init"!==e.stage?Object(d.jsx)("p",{className:"msg",children:e.message}):"",t]})};var I=function(){return Object(d.jsx)("div",{className:"App",children:Object(d.jsx)(b,{children:Object(d.jsx)(L,{})})})};r.a.render(Object(d.jsx)(i.a.StrictMode,{children:Object(d.jsx)(I,{})}),document.getElementById("root"))},2:function(t,e,a){t.exports={gameboard:"gameboard_gameboard__344mG",wml:"gameboard_wml__1BvXp",cell:"gameboard_cell__2DYyY",allowed:"gameboard_allowed__gazvv",notAllowed:"gameboard_notAllowed__1vRbK",hasShip:"gameboard_hasShip__rQQMj",attackAllowed:"gameboard_attackAllowed__2sUE1",attackMiss:"gameboard_attackMiss__3f7ju",attackHit:"gameboard_attackHit__3ixC5"}},7:function(t,e,a){t.exports={axisContainer:"shipsPlacement_axisContainer__3NNzC",axisBtn:"shipsPlacement_axisBtn__1uOeo",list:"shipsPlacement_list__avdG8"}},9:function(t,e,a){t.exports={flexContainer:"gameStart_flexContainer__1F_st",gameTitle:"gameStart_gameTitle__1sCgw"}}},[[18,1,2]]]);
//# sourceMappingURL=main.f3ec38e8.chunk.js.map